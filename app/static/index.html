<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Speech To Text Demo Application</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script
            src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
        <script>
        tailwind.config = {
            theme: {
            extend: {
                colors: {
                clifford: "#da373d",
                },
            },
            },
        };
        </script>
        <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
            content-visibility: auto;
            }
        }
    </style>
    </head>
    <body>
        <header
            class="bg-slate-50 lg:fixed lg:inset-y-0 lg:left-0 lg:flex lg:w-100
            lg:items-start lg:overflow-y-auto xl:w-100">
            <div
                class="relative z-10 mx-auto px-4 pb-4 pt-10 sm:px-6
                md:max-w-sm md:px-4 lg:min-h-full lg:flex-auto lg:border-x
                lg:border-slate-200 lg:p-12 xl:p-12
                flex items-center">
                <div class="flex items-center justify-content-center h-full
                    flex-col">
                    <div class="relative mx-auto block w-80 overflow-hidden
                        rounded-lg shadow-xl shadow-slate-200 sm:w-96
                        sm:rounded-xl lg:rounded-2xl flex items-center
                        justify-center font-sans rounded-xl border-2
                        border-dashed border-blue-400
                        bg-white lg:w-full xl:min-h-[25vh] lg:min-h-[25vh]
                        sm:min-h-min md:min-h-min" id="drop-area">
                        <label for="dropzone-file" class="mx-auto cursor-pointer
                            flex flex-col items-center p-6
                            text-center">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                class="h-10
                                w-10 text-blue-500 upload-label-information"
                                fill="none" viewBox="0 0
                                24
                                24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round"
                                    stroke-linejoin="round" d="M7 16a4 4 0
                                    01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0
                                    011
                                    9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <h2 class="mt-4 text-xl font-medium
                                    text-gray-700 tracking-wide
                                    upload-label-information">Audio File</h2>
                                <p class="mt-2 text-gray-500 tracking-wide
                                    upload-label-information">Upload
                                    or drag & drop a WAV file. </p>
                                <input id="dropzone-file" type="file"
                                    class="hidden upload-label-information" />
                                <div id="upload-file-details" class="mx-auto
                                    px-4 flex flex-col text-left"></div>
                                <button id="upload-button" class="mt-24
                                    bg-blue-500 hover:bg-blue-700 text-white
                                    font-bold py-2 px-4 rounded text-right"
                                    style="display: none;">Upload</button>
                            </label>
                        </div>
                        <div class="mt-10 text-center lg:mt-12 lg:text-left">
                            <p class="text-xl font-bold text-slate-900">
                                <a href="/">Speech To Text Demo
                                    Application</a>
                            </p>
                            <p class="mt-3 text-lg font-light leading-8
                                text-slate-600">
                                This is a demo application for the demostration
                                of the speech to text conversion using custom
                                model.
                            </p>
                        </div>
                    </div>
                </div>
            </header>
            <div class="prose">
                <h1 class="text-3xl font-bold text-clifford">WebSocket Chat</h1>
                <h2>Your ID: <span id="ws-id"></span></h2>
                <form action="" onsubmit="sendMessage(event)">
                    <input type="text" id="messageText" autocomplete="off"
                        accept="audio/wav" />
                    <button>Send</button>
                </form>
                <ul id="messages"></ul>
            </div>
            <script>
                let dropArea = document.getElementById('drop-area')

                    // Prevent default drag behaviors
                    ;['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false)
                    document.body.addEventListener(eventName, preventDefaults, false)
                    })

                    // Highlight drop area when item is dragged over it
                    ;['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, highlight, false)
                    })

                    ;['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, unhighlight, false)
                    })

                    // Handle dropped files
                    dropArea.addEventListener('drop', handleDrop, false)

                    function handleDrop(e) {
                        let dt = e.dataTransfer
                        let files = dt.files
                        document.getElementById("dropzone-file").files = files
                        // trigger file uploaded event
                        document.getElementById("dropzone-file").dispatchEvent(new Event('change'));
                    }

                    function preventDefaults (e) {
                        e.preventDefault()
                        e.stopPropagation()
                    }

                    function highlight(e) {
                    dropArea.classList.add('bg-blue-100')
                    }

                    function unhighlight(e) {
                    dropArea.classList.remove('bg-blue-100')
                    }

                document.getElementById("dropzone-file").addEventListener("change", function (e) {
                    prepareForUpload(e);
                });

                function prepareForUpload(e) {
                    var file = e.target.files[0];
                    // Show the name of the file that was uploaded
                    showFileDetails(file);
                    // Show upload button
                    document.getElementById("upload-button").style.display = "block";
                    var upload_info_labels = document.getElementsByClassName("upload-label-information")
                    for (var i = 0; i < upload_info_labels.length; i++) {
                        upload_info_labels[i].style.display = "none";
                    }
                }
                function showFileDetails(file) {
                    var fileDetails = document.getElementById("upload-file-details");
                    fileDetails.innerHTML = "";
                    var fileName = document.createElement("h2");
                    fileName.classList.add("mt-4", "text-xl", "font-medium", "text-slate-700");
                    fileName.textContent = file.name;
                    fileDetails.appendChild(fileName);
                    var fileSize = document.createElement("p");
                    fileSize.classList.add("font-mono", "text-sm", "order-first", "leading-7", "text-slate-500");
                    fileSize.textContent = file.size + " bytes";
                    fileDetails.appendChild(fileSize);
                    var fileType = document.createElement("p");
                    fileType.classList.add("mt-1", "text-xs", "leading-7", "text-slate-700");
                    var file_type = file.type || "n/a";
                    fileType.textContent = "Type: " + file_type.toUpperCase();
                    fileDetails.appendChild(fileType);
                }
                var client_id = Date.now();
                document.querySelector("#ws-id").textContent = client_id;
                var ws = new WebSocket(`ws://localhost:8000/ws/${client_id}`);
                ws.onmessage = function (event) {
                    var messages = document.getElementById("messages");
                    var message = document.createElement("li");
                    var content = document.createTextNode(event.data);
                    message.appendChild(content);
                    messages.appendChild(message);
                };
                function sendMessage(event) {
                    var input = document.getElementById("messageText");
                    ws.send(input.value);
                    input.value = "";
                    event.preventDefault();
                }
    </script>
        </body>
    </html>